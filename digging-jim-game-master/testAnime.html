<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test anime</title>
</head>
<body>
    <img id="myimg" style="position:relative; top:20; left:20;" src="images/block.jpg">

    <script>
        
        "use strict"

        function AnimatedImage (id,xpos,ypos,width,height)
        {
            this.id = id;
            this.width = width; 
            this.height = height;
            this.img = document.getElementById(id);
            this.img.width = this.width;
            this.img.height = this.height;
            this.setTop(ypos);
            this.setLeft(xpos);
            this.srcanime = new AnimateSrc(this);
            this.moveAnime = new AnimateMove(this);
        }

        
        AnimatedImage.prototype.setLeft = function (val)
        {
            this.img.style.left = val + "px";
        }
        AnimatedImage.prototype.setTop = function (val)
        {
            this.img.style.top = val + "px";
        }
        AnimatedImage.prototype.getTop = function ()
        {
            return parseInt(this.img.style.top);
        }
        AnimatedImage.prototype.getLeft = function ()
        {
            return parseInt(this.img.style.left);
        }

        AnimatedImage.prototype.setSrc = function(src)
        {
            this.img.src = src;
        }

        AnimatedImage.prototype.getSrc = function()
        {
            return this.img.src;
        }

        AnimatedImage.prototype.move = function(keys,duration,dx,dy)
        {
            this.srcanime.play(keys,duration);
            this.moveAnime.playX(dx,duration);
            this.moveAnime.playY(dy,duration);
        }

        AnimatedImage.prototype.moveX = function(keys,duration,dx)
        {
            this.srcanime.play(keys,duration);
            this.moveAnime.playX(dx,duration);
        }

        AnimatedImage.prototype.moveY = function(keys,duration,dy)
        {
            this.srcanime.play(keys,duration);
            this.moveAnime.playY(dy,duration);
        }





        // animation of the src of animated image
        var AnimateSrc = function (image)
        {
            this.animeTimer = null;
            this.image = image;
            this.animeCounter = 0;
            this.animeRepeat = 0;
            this.duration = 0;

            
        }

        AnimateSrc.prototype.stop = function () {
            clearInterval(this.animeTimer);
        }

        AnimateSrc.prototype.onPlay = function (){

        }

        AnimateSrc.prototype.duringPlay = function (){
        }


        AnimateSrc.prototype.onFinish = function() {
            console.log("finish anime");
        }

        AnimateSrc.prototype.play = function(keys,duration){

            //this.onPlay();
            this.animeCounter = 0;
            this.animeRepeat = keys.length;
            this.duration = duration;
            console.log(this);

            var self = this;
            this.animeTimer = setInterval(function () {
                if(self.animeCounter < self.animeRepeat)
                {
                    self.duringPlay();
                    self.image.setSrc(keys[self.animeCounter++]);
                    console.log(self.image)
                }
                else
                {
                    self.stop();
                    self.onFinish();
                }
            },self.duration/self.animeRepeat );

        }


        var AnimateMove = function (image)
        {
            this.moveTimerX = 0;
            this.moveTimerY = 0;
            this.image = image;
            this.targetX = 0;
            this.targetY = 0;
            this.durationX = 0;
            this.durationY = 0;
            this.speedX = 0;
            this.speedY = 0;

        }

        AnimateMove.prototype.stopX = function () {
            clearInterval(this.moveTimerX);
        }

        AnimateMove.prototype.stopY = function () {
            clearInterval(this.moveTimerY);
        }

        AnimateMove.prototype.playX = function(dx,durationX){
            // move
            this.targetX = this.image.getLeft() + dx;
            this.durationX = durationX;
            this.speedX = (dx/this.durationX) * 50;
            var self = this;
            this.moveTimerX = setInterval(function () {
                if(self.image.getLeft() < self.targetX)
                {
                    self.image.setLeft(self.image.getLeft() + self.speedX);
                }
                else
                {
                    self.image.setLeft(self.targetX);
                    self.stopX();
                }

            }, 50);
        }

        AnimateMove.prototype.playY = function(dy,durationY){
        // move
        this.targetY =  this.image.getTop() + dy;
        this.durationY = durationY;
        this.speedY = (dy/this.durationY) * 50;
        var self = this;
        this.moveTimerY = setInterval(function () {
            if(self.image.getTop() < self.targetY)
            {
                self.image.setTop(self.image.getTop() + self.speedY );
            }
            else
            {
                self.stopY();
                self.image.setTop(self.targetY);
            }

        }, 50);
    }


        var animeImage = new AnimatedImage("myimg",100,100,64,64);

        animeImage.move(["images/1.png","images/block.jpg","images/Diamond.png"],1000,64,64);
    </script>
</body>
</html>